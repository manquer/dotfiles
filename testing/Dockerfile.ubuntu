# Dockerfile for testing dotfiles on Ubuntu
ARG UBUNTU_VERSION=24.04
FROM ubuntu:${UBUNTU_VERSION}

# Avoid interactive prompts during installation
ENV DEBIAN_FRONTEND=noninteractive

# Install sudo and create a test user
RUN apt-get update && \
    apt-get install -y sudo curl git && \
    useradd -m -s /bin/bash testuser && \
    echo "testuser ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Switch to test user
USER testuser
WORKDIR /home/testuser

# Set up basic environment
ENV HOME=/home/testuser
ENV USER=testuser
ENV PATH="${HOME}/.local/bin:${PATH}"

# Copy dotfiles to the container
COPY --chown=testuser:testuser . /home/testuser/.local/share/chezmoi/

# Entry point for testing
CMD ["/bin/bash"]
