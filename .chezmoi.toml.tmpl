{{- /* Detect OS */}}
{{- $isDarwin := eq .chezmoi.os "darwin" -}}
{{- $isLinux := eq .chezmoi.os "linux" -}}
{{- $isArch := false -}}
{{- $isDebian := false -}}
{{- $isUbuntu := false -}}
{{- if $isLinux -}}
{{-   if stat "/etc/arch-release" -}}
{{-     $isArch = true -}}
{{-   end -}}
{{-   if stat "/etc/debian_version" -}}
{{-     $isDebian = true -}}
{{-   end -}}
{{-   if and $isDebian (stat "/etc/lsb-release") -}}
{{-     $isUbuntu = true -}}
{{-   end -}}
{{- end -}}

{{- /* Detect machine type */}}
{{- $machineType := "personal" -}}
{{- if or (contains "work" .chezmoi.hostname) (contains "corp" .chezmoi.hostname) (contains "talview" .chezmoi.hostname) -}}
{{-   $machineType = "work" -}}
{{- end -}}
{{- $machineType := promptStringOnce . "machine.type" "Machine type (work/personal)" $machineType -}}

{{- /* Detect GUI environment */}}
{{- $hasGui := false -}}
{{- if $isDarwin -}}
{{-   $hasGui = true -}}
{{- else if $isLinux -}}
{{-   $hasGui = or (env "DISPLAY") (env "WAYLAND_DISPLAY") -}}
{{- end -}}

{{- /* Prompt for work-specific data */}}
{{- $name := promptStringOnce . "git.name" "Git user name" -}}
{{- $email := promptStringOnce . "git.email" "Git user email" -}}
{{- $signingkey := promptStringOnce . "git.signingkey" "Git GPG signing key (leave empty if none)" -}}

{{- $codexBaseUrl := "" -}}
{{- if eq $machineType "work" -}}
{{-   $codexBaseUrl = promptStringOnce . "codex.baseUrl" "Codex LiteLLM base URL" "https://litellm.talview.com/v1" -}}
{{- end -}}

[data]
    [data.machine]
        type = {{ $machineType | quote }}
        hostname = {{ .chezmoi.hostname | quote }}
        os = {{ .chezmoi.os | quote }}
        arch = {{ .chezmoi.arch | quote }}
        isLinux = {{ $isLinux }}
        isDarwin = {{ $isDarwin }}
        isArch = {{ $isArch }}
        isDebian = {{ $isDebian }}
        isUbuntu = {{ $isUbuntu }}
        isWork = {{ eq $machineType "work" }}
        isPersonal = {{ eq $machineType "personal" }}
        hasGui = {{ $hasGui }}

    [data.git]
        name = {{ $name | quote }}
        email = {{ $email | quote }}
        signingkey = {{ $signingkey | quote }}

    [data.codex]
        baseUrl = {{ $codexBaseUrl | quote }}
